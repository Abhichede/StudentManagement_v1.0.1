<div class="mdl-cell--12-col mdl-typography--text-center">
  <h3>Student Fees</h3>
</div>
<div class="mdl-grid">
  <div class="mdl-layout-spacer mdl-cell mdl-cell--1-col"></div>
  <div class="table-container mdl-cell mdl-cell--11-col" style="overflow: auto">
    <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" id="myTable">
      <thead>

        <tr>
          <form action="<%= student_fees_path %>">
          <th colspan="2">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="payment_start_date_div">
              <label for="payment_start_date" class="mdl-textfield__label">Start</label>
              <input type="text" name="start_date" id="payment_start_date" class="mdl-textfield__input">
            </div>
          </th>
          <th colspan="2">
            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" id="payment_end_date_div">
              <label for="payment_end_date" class="mdl-textfield__label">End</label>
              <input type="text" name="end_date" id="payment_end_date" class="mdl-textfield__input">
            </div>
          </th>
          <th colspan="1">
            <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--accent">Filter</button>

          </th>
          </form>
          <th colspan="3"><%= link_to "Export to Excel", student_fees_path(format: "xls", start_date: params[:start_date], end_date: params[:end_date]), class: 'mdl-button mdl-js-button mdl-button--raised mdl-button--colored' %></th>
        </tr>
        <tr>
          <th class="mdl-data-table__cell--non-numeric">Student</th>
          <th class="mdl-data-table__cell--non-numeric">Payment date</th>
          <th class="mdl-data-table__cell--non-numeric">Installment no</th>
          <th class="mdl-data-table__cell--non-numeric">Amount</th>
          <th class="mdl-data-table__cell--non-numeric">Payment method</th>
          <th class="mdl-data-table__cell--non-numeric">Payment desc</th>
          <th class="mdl-data-table__cell--non-numeric">Paid by</th>
          <th class="mdl-data-table__cell--non-numeric">Received by</th>

        </tr>
      </thead>

      <tbody style=" height: 20rem;">
        <% @student_fees.each do |student_fee| %>
          <tr>
            <td class="mdl-data-table__cell--non-numeric"><%= link_to student_fee.student.first_name.upcase + ' ' + student_fee.student.last_name.upcase, student_path(student_fee.student) %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.payment_date %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.installment_no %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.amount %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.payment_method %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.payment_desc %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.paid_by %></td>
            <td class="mdl-data-table__cell--non-numeric"><%= student_fee.received_by %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="mdl-layout-spacer"></div>
</div>
<div class="mdl-grid">
  <div class="mdl-layout-spacer"></div>
<%
  total_allocated_fees = 0
  total_discount = 0
  total_paid_fees = 0

  if !@student_fees.blank?
    Student.all.each do |fee|
      total_allocated_fees += fee.allocated_fee.to_f.round(2)
      total_discount += fee.discount.to_f.round(2)
      total_paid_fees += fee.total_paid.to_f.round(2)
    end
    total_balance_fee = (total_allocated_fees - total_discount) - total_paid_fees
  end
%>
<div style="overflow: auto">
  <% if current_user.role == 'ADMIN' %>
  <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">
    <thead>
      <tr>
        <th class="mdl-data-table__cell--non-numeric">Allocated Fee</th>
        <th></th>
        <th class="mdl-data-table__cell--non-numeric">Discount</th>
        <th ></th>
        <th class="mdl-data-table__cell--non-numeric">Paid Fee</th>
        <th></th>
        <th class="mdl-data-table__cell--non-numeric">Balance Fee</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="mdl-data-table__cell--non-numeric" colspan="2">&#8377; <%= number_to_indian_currency(total_allocated_fees) %></td>
        <td class="mdl-data-table__cell--non-numeric" colspan="2">&#8377; <%= number_to_indian_currency(total_discount) %></td>
        <td class="mdl-data-table__cell--non-numeric" colspan="2">&#8377; <%= number_to_indian_currency(total_paid_fees) %></td>
        <td class="mdl-data-table__cell--non-numeric" colspan="2">&#8377; <%= number_to_indian_currency(total_balance_fee) %></td>
      </tr>
    </tbody>
  </table>
  <% end %>
</div>
  <div class="mdl-layout-spacer"></div>
</div>